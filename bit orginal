#include <stdio.h>
#include <string.h>

int main()
{
    int i = 0, j = 0, k = 0, len, lenf, lend, count = 0;
    char sorc[50], stf[80] = {'\0'}, destf[50] = {'\0'}, flag[] = "01111110";

    printf("\nEnter the bit stream in binary:\n");
    fgets(sorc, sizeof(sorc), stdin);

    // Remove newline added by fgets
    sorc[strcspn(sorc, "\n")] = '\0';

    strcpy(stf, flag);
    len = strlen(sorc);
    lenf = strlen(flag);
    j = lenf;

    // Bit Stuffing
    count = 0;
    for (i = 0; i < len; i++)
    {
        if (sorc[i] == '1')
            count++;
        else
            count = 0;

        stf[j++] = sorc[i];

        if (count == 5)
        {
            stf[j++] = '0';  // Insert stuffed bit
            count = 0;
        }
    }

    lend = j;
    strcat(stf, flag);

    printf("\nThe Stuffed Data is:\n%s\n", stf);

    // Bit De-stuffing
    count = 0;
    k = 0;

    for (j = lenf; j < lend; j++)
    {
        if (stf[j] == '1')
            count++;
        else
            count = 0;

        destf[k++] = stf[j];

        if (count == 5)
        {
            j++;      // Skip the stuffed 0
            count = 0;
        }
    }

    destf[k] = '\0';

    printf("\nThe Destuffed Data is:\n%s\n", destf);

    return 0;
}
